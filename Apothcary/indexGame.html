<!--
Single-file HTML page: "药物少女的呢喃" themed learning hub.
Features:
- Hero with title and SVG art placeholder
- "Hook" analysis area where user maps book’s hooks to learning
- Quest/gamified study list (add tasks, mark complete, earn chapter reading rewards)
- Pomodoro timer with start/stop/reset
- Progress bar and persistent localStorage save
- Responsive and aesthetic styling (Tailwind NOT used; pure CSS with Google Fonts)

You can copy this file to a .html and open in your browser.
-->

<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>药物少女的呢喃 — 学习化为热情</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;700&family=Playfair+Display:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg: #0f1724;
        --card: #0b1220;
        --accent: #9b7cff;
        --muted: #9aa4b2;
        --glass: rgba(255, 255, 255, 0.04);
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: "Noto Sans SC", system-ui, -apple-system, Segoe UI, Roboto,
          "Helvetica Neue", Arial;
        color: #e6eef8;
        background: radial-gradient(
            1200px 600px at 10% 10%,
            rgba(155, 124, 255, 0.08),
            transparent
          ),
          linear-gradient(180deg, #081025 0%, #071028 100%);
      }
      .wrap {
        max-width: 1100px;
        margin: 28px auto;
        padding: 22px;
        display: grid;
        grid-template-columns: 1fr 380px;
        gap: 22px;
      }
      header {
        grid-column: 1/-1;
        display: flex;
        align-items: center;
        gap: 18px;
      }
      .logo {
        width: 84px;
        height: 84px;
        border-radius: 12px;
        background: linear-gradient(135deg, var(--accent), #66d3ff);
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 6px 30px rgba(0, 0, 0, 0.6);
      }
      .logo svg {
        width: 64px;
        height: 64px;
        filter: drop-shadow(0 6px 18px rgba(155, 124, 255, 0.12));
      }
      h1 {
        font-family: "Playfair Display", serif;
        margin: 0;
        font-size: 26px;
      }
      p.lead {
        margin: 0;
        color: var(--muted);
      }

      main {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.02),
          rgba(255, 255, 255, 0.01)
        );
        padding: 18px;
        border-radius: 14px;
        box-shadow: 0 8px 40px rgba(2, 6, 23, 0.6);
      }
      .panel {
        background: var(--card);
        padding: 14px;
        border-radius: 12px;
        margin-bottom: 14px;
      }
      .hooks {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      .hook {
        background: var(--glass);
        padding: 10px 12px;
        border-radius: 10px;
        min-width: 150px;
      }
      label {
        display: block;
        font-size: 13px;
        color: var(--muted);
        margin-bottom: 6px;
      }
      textarea,
      input[type="text"] {
        width: 100%;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.03);
        background: transparent;
        color: inherit;
      }

      .quests {
        display: grid;
        grid-template-columns: 1fr;
        gap: 10px;
      }
      .quest {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px;
        border-radius: 10px;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.01),
          rgba(0, 0, 0, 0.02)
        );
        border: 1px solid rgba(255, 255, 255, 0.02);
      }
      .quest .title {
        flex: 1;
      }
      .btn {
        background: var(--accent);
        border: none;
        color: #071025;
        padding: 8px 12px;
        border-radius: 10px;
        cursor: pointer;
        font-weight: 700;
      }
      .btn.ghost {
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.06);
        color: var(--muted);
      }

      .right {
        position: relative;
      }
      .card {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.02),
          rgba(0, 0, 0, 0.02)
        );
        padding: 16px;
        border-radius: 14px;
        margin-bottom: 14px;
      }

      .timer {
        font-size: 42px;
        font-weight: 700;
        text-align: center;
        margin: 10px 0;
      }
      .controls {
        display: flex;
        gap: 8px;
        justify-content: center;
      }

      .progress-wrap {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .progress {
        height: 12px;
        background: rgba(255, 255, 255, 0.03);
        border-radius: 12px;
        overflow: hidden;
        flex: 1;
      }
      .bar {
        height: 100%;
        background: linear-gradient(90deg, var(--accent), #66d3ff);
        width: 0%;
      }

      footer {
        grid-column: 1/-1;
        margin-top: 8px;
        color: var(--muted);
        font-size: 13px;
        text-align: center;
      }

      /* Responsive */
      @media (max-width: 980px) {
        .wrap {
          grid-template-columns: 1fr;
          padding: 14px;
        }
        .right {
          order: -1;
        }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <div class="logo" aria-hidden>
          <!-- small potion + quill SVG -->
          <svg
            viewBox="0 0 64 64"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <rect
              x="6"
              y="34"
              width="52"
              height="20"
              rx="6"
              fill="white"
              opacity="0.06"
            />
            <path
              d="M32 4c6 0 15 6 15 14 0 8-9 12-15 12s-15-4-15-12C17 10 26 4 32 4z"
              fill="white"
              opacity="0.08"
            />
            <path
              d="M20 36s4 0 6-4"
              stroke="white"
              stroke-width="1.6"
              stroke-linecap="round"
              opacity="0.9"
            />
            <circle cx="44" cy="16" r="6" fill="white" opacity="0.06" />
          </svg>
        </div>
        <div>
          <h1>药物少女的呢喃 — 学习化为热情</h1>
          <p class="lead">
            把你对系列的沉迷变成学习的燃料：故事化、任务化、奖励化。
          </p>
        </div>
      </header>

      <main>
        <section class="panel">
          <h3>1) 提取 "hook"（能量点）</h3>
          <div class="hooks" id="hooks">
            <div class="hook">
              <strong>世界观</strong>
              <div style="font-size: 13px; color: var(--muted)">
                药物、实验室、伦理冲突
              </div>
            </div>
            <div class="hook">
              <strong>主角成长</strong>
              <div style="font-size: 13px; color: var(--muted)">
                从无知到掌握——训练弧
              </div>
            </div>
            <div class="hook">
              <strong>神秘与解密</strong>
              <div style="font-size: 13px; color: var(--muted)">
                推动阅读的疑问与揭秘
              </div>
            </div>
          </div>
          <label for="hook-user">写下你被吸引的点（一句话）</label>
          <input
            id="hook-user"
            placeholder="例如：我喜欢主角破案时的推理与化学细节"
          />
        </section>

        <section class="panel">
          <h3>2) 将 Hook 映射到学习目标</h3>
          <p style="margin-top: 0; color: var(--muted)">
            把书里的元素转换成现实的学习项目（示例已自动生成 — 可编辑）
          </p>
          <label>你的学习科目</label>
          <input id="subject" placeholder="例如：有机化学 / 基础编程 / 俄语" />

          <label style="margin-top: 8px">自动建议</label>
          <textarea id="mapping" rows="4">
示例：把主角的"实验证明"变成每周做一题有机反应机理练习；把解密线索写成实验观察笔记。</textarea
          >
          <div style="display: flex; gap: 8px; margin-top: 8px">
            <button class="btn" id="applyMapping">应用为任务</button>
            <button class="btn ghost" id="clearMapping">重置</button>
          </div>
        </section>

        <section class="panel">
          <h3>3) 任务（Quests）</h3>
          <div style="margin-bottom: 8px; color: var(--muted)">
            完成任务来赚取阅读时间（章节/段落）作为奖励。
          </div>
          <div style="display: flex; gap: 8px; margin-bottom: 10px">
            <input
              id="taskTitle"
              placeholder="新任务：例如：阅读教材第3章并做题"
            />
            <button class="btn" id="addTask">添加</button>
          </div>
          <div class="quests" id="questList">
            <!-- dynamic tasks -->
          </div>
        </section>

        <section class="panel">
          <h3>4) 学习日志（简单）</h3>
          <textarea
            id="journal"
            rows="4"
            placeholder="写下你今天学到的关键点或书中灵感如何帮助了你的理解..."
          ></textarea>
          <div style="display: flex; gap: 8px; margin-top: 8px">
            <button class="btn" id="saveJournal">保存日志</button>
            <button class="btn ghost" id="loadJournal">加载日志</button>
          </div>
        </section>
      </main>

      <aside class="right">
        <div class="card">
          <h4>番外面板 — 番外：Pomodoro 计时器</h4>
          <div class="timer" id="timer">25:00</div>
          <div class="controls">
            <button class="btn" id="start">开始</button>
            <button class="btn ghost" id="pause">暂停</button>
            <button class="btn ghost" id="reset">重置</button>
          </div>
          <div style="margin-top: 10px; font-size: 13px; color: var(--muted)">
            完成一个番茄（25 分）= 解锁
            <strong id="rewardText">10 分钟</strong> 阅读时间
          </div>
        </div>

        <div class="card">
          <h4>进度</h4>
          <div class="progress-wrap">
            <div style="font-size: 13px; color: var(--muted)">任务完成率</div>
            <div class="progress"><div class="bar" id="progressBar"></div></div>
            <div id="percent" style="width: 40px; text-align: right">0%</div>
          </div>
          <div
            style="
              margin-top: 10px;
              display: flex;
              gap: 8px;
              justify-content: space-between;
              align-items: center;
            "
          >
            <div style="font-size: 13px; color: var(--muted)">
              累计阅读奖励：
            </div>
            <div id="totalReward">0 分钟</div>
          </div>
        </div>

        <div class="card">
          <h4>快速提示</h4>
          <ul style="margin: 0; padding-left: 18px; color: var(--muted)">
            <li>把任务写得具体（可衡量）</li>
            <li>使用阅读作为完成任务的奖励</li>
            <li>把问题写下来，把它当作谜题去解</li>
          </ul>
        </div>
      </aside>

      <footer>
        这个页面是一个模板 —
        我可以把它导出为单文件、添加书籍插画占位、或把奖励机制更改为章节数量。想要我帮你定制吗？
      </footer>
    </div>

    <script>
      // Simple app state + persistence
      const qListEl = document.getElementById("questList");
      const addBtn = document.getElementById("addTask");
      const taskInput = document.getElementById("taskTitle");
      const mappingEl = document.getElementById("mapping");
      const applyMapping = document.getElementById("applyMapping");
      const clearMapping = document.getElementById("clearMapping");
      const subjectEl = document.getElementById("subject");
      const journalEl = document.getElementById("journal");
      const saveJournal = document.getElementById("saveJournal");
      const loadJournal = document.getElementById("loadJournal");
      const hookInput = document.getElementById("hook-user");

      const progressBar = document.getElementById("progressBar");
      const percentEl = document.getElementById("percent");
      const totalRewardEl = document.getElementById("totalReward");
      const rewardText = document.getElementById("rewardText");

      // Load from localStorage
      const STORAGE_KEY = "ywyqn_state_v1";
      let state = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
      if (!state.tasks) state.tasks = [];
      if (!state.rewards) state.rewards = 0; // minutes

      function saveState() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        updateUI();
      }

      function addTask(title, done = false) {
        if (!title) return;
        state.tasks.push({ id: Date.now(), title, done });
        saveState();
      }
      addBtn.addEventListener("click", () => {
        addTask(taskInput.value);
        taskInput.value = "";
      });

      function toggleTask(id) {
        state.tasks = state.tasks.map((t) =>
          t.id === id ? { ...t, done: !t.done } : t
        );
        saveState();
      }
      function removeTask(id) {
        state.tasks = state.tasks.filter((t) => t.id !== id);
        saveState();
      }

      function updateUI() {
        // quests
        qListEl.innerHTML = "";
        state.tasks.forEach((t) => {
          const el = document.createElement("div");
          el.className = "quest";
          const chk = document.createElement("input");
          chk.type = "checkbox";
          chk.checked = t.done;
          chk.addEventListener("change", () => toggleTask(t.id));
          const title = document.createElement("div");
          title.className = "title";
          title.textContent = t.title;
          const rem = document.createElement("button");
          rem.className = "btn ghost";
          rem.textContent = "删除";
          rem.addEventListener("click", () => removeTask(t.id));
          el.appendChild(chk);
          el.appendChild(title);
          el.appendChild(rem);
          qListEl.appendChild(el);
        });

        // progress
        const total = state.tasks.length;
        const done = state.tasks.filter((t) => t.done).length;
        const pct = total ? Math.round((done / total) * 100) : 0;
        progressBar.style.width = pct + "%";
        percentEl.textContent = pct + "%";
        totalRewardEl.textContent = state.rewards + " 分钟";
      }

      // map -> tasks
      applyMapping.addEventListener("click", () => {
        const mapText = mappingEl.value.trim();
        const subj = subjectEl.value.trim() || "学习项目";
        if (!mapText) return alert("请先写入映射建议");
        // simple split heuristics: sentences -> tasks
        const parts = mapText
          .split(/[。;\n]/)
          .map((s) => s.trim())
          .filter(Boolean);
        parts.forEach((p) => addTask(`${subj}：${p}`));
      });
      clearMapping.addEventListener("click", () => {
        mappingEl.value =
          '示例：把主角的"实验证明"变成每周做一题有机反应机理练习；把解密线索写成实验观察笔记。';
      });

      // Journal
      saveJournal.addEventListener("click", () => {
        state.journal = journalEl.value;
        saveState();
        alert("已保存笔记");
      });
      loadJournal.addEventListener("click", () => {
        journalEl.value = state.journal || "";
        alert("已加载笔记");
      });

      // Pomodoro Timer
      let timer = { running: false, remaining: 25 * 60, interval: null };
      const timerEl = document.getElementById("timer");
      const startBtn = document.getElementById("start");
      const pauseBtn = document.getElementById("pause");
      const resetBtn = document.getElementById("reset");

      function formatTime(s) {
        const m = Math.floor(s / 60);
        const sec = s % 60;
        return String(m).padStart(2, "0") + ":" + String(sec).padStart(2, "0");
      }
      function tick() {
        if (timer.remaining <= 0) {
          clearInterval(timer.interval);
          timer.running = false;
          rewardAfterPomodoro();
          updateTimerUI();
          return;
        }
        timer.remaining--;
        updateTimerUI();
      }
      function updateTimerUI() {
        timerEl.textContent = formatTime(timer.remaining);
      }

      startBtn.addEventListener("click", () => {
        if (timer.running) return;
        timer.running = true;
        timer.interval = setInterval(tick, 1000);
      });
      pauseBtn.addEventListener("click", () => {
        if (timer.interval) clearInterval(timer.interval);
        timer.running = false;
      });
      resetBtn.addEventListener("click", () => {
        if (timer.interval) clearInterval(timer.interval);
        timer.running = false;
        timer.remaining = 25 * 60;
        updateTimerUI();
      });

      function rewardAfterPomodoro() {
        const rewardMins = 10;
        state.rewards = (state.rewards || 0) + rewardMins;
        saveState();
        alert("番茄完成！已获得 " + rewardMins + " 分钟阅读奖励！");
      }

      // restore UI
      document.addEventListener("DOMContentLoaded", () => {
        // load hook to mapping if exists
        if (state.hook) hookInput.value = state.hook;
        if (state.subject) subjectEl.value = state.subject;
        if (state.mapping) mappingEl.value = state.mapping;
        if (state.journal) journalEl.value = state.journal;
        if (state.rewards) totalRewardEl.textContent = state.rewards + " 分钟";
        updateUI();
      });

      // persist on input
      hookInput.addEventListener("input", () => {
        state.hook = hookInput.value;
        saveState();
      });
      subjectEl.addEventListener("input", () => {
        state.subject = subjectEl.value;
        saveState();
      });
      mappingEl.addEventListener("input", () => {
        state.mapping = mappingEl.value;
        saveState();
      });

      // small UX: allow pressing enter to add task
      taskInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          addTask(taskInput.value);
          taskInput.value = "";
          e.preventDefault();
        }
      });

      // initial save to ensure structure
      saveState();
    </script>
  </body>
</html>
